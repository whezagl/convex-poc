---
phase: 01-project-setup
plan: 02
type: execute
domain: docker
---

<objective>
Set up self-hosted Convex backend via Docker Compose with local development configuration.

Purpose: Establish the persistent state backend for agent sessions and orchestration using self-hosted Convex.
Output: Running Docker Compose setup with Convex backend and dashboard accessible locally.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-project-setup/01-RESEARCH.md
@.planning/phases/01-project-setup/01-01-SUMMARY.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create docker-compose.yml for self-hosted Convex</name>
  <files>docker-compose.yml, .env.example, .gitignore</files>
  <action>
    Create docker-compose.yml with two services:
    1. convex-backend:
       - image: ghcr.io/get-convex/convex-backend:latest
       - ports: 3210:3210 (CONVEX_CLOUD_ORIGIN - backend API)
       - ports: 3211:3211 (CONVEX_SITE_ORIGIN - http action endpoints)
       - environment:
         - CONVEX_CLOUD_ORIGIN=http://localhost:3210
         - CONVEX_SITE_ORIGIN=http://localhost:3211
       - volumes: convex_data:/convex/data (persistent storage)
       - restart: unless-stopped

    2. convex-dashboard:
       - image: ghcr.io/get-convex/convex-dashboard:latest
       - ports: 6791:6791 (dashboard UI)
       - environment:
         - CONVEX_SELF_HOSTED_URL: http://convex-backend:3210
         - CONVEX_SELF_HOSTED_ADMIN_KEY: ${CONVEX_ADMIN_KEY}
       - depends_on: convex-backend
       - restart: unless-stopped

    Create volumes section for convex_data

    Create .env.example with:
    - CONVEX_ADMIN_KEY=your-admin-key-here

    Add to .gitignore:
    - .env (contains actual admin key)
    - convex_data/ (local Docker volume data)

    Use EXACT pattern from Phase 1 research (Pattern 4: Self-Hosted Convex via Docker Compose). DO NOT modify port numbers or service names without reason.
  </action>
  <verify>
    cat docker-compose.yml shows valid YAML with two services
    docker-compose config validates without errors
    cat .env.example shows CONVEX_ADMIN_KEY placeholder
    cat .gitignore includes .env and convex_data/
  </verify>
  <done>
    docker-compose.yml created with Convex backend and dashboard services
    .env.example created with admin key placeholder
    .gitignore updated to exclude .env and convex_data
  </done>
</task>

<task type="auto">
  <name>Task 2: Initialize Convex project structure</name>
  <files>convex/schema.ts, convex/.gitkeep, .gitignore</files>
  <action>
    Create convex/ directory structure:
    - convex/schema.ts (placeholder schema for Phase 2)
    - convex/.gitkeep (preserve directory in git)

    Create convex/schema.ts with:
    - import { defineSchema, defineTable } from "convex/server"
    - import { v } from "convex/values"
    - export default defineSchema({})  // Empty schema for now, Phase 2 will define tables

    Update .gitignore to also include:
    - convex/_generated/ (auto-generated Convex types)

    DO NOT define any schema tables yet (that's Phase 2 work). Just create the placeholder file.
  </action>
  <verify>
    ls -la convex/ shows schema.ts exists
    cat convex/schema.ts shows valid TypeScript with empty defineSchema
    cat .gitignore includes convex/_generated/
  </verify>
  <done>
    convex/ directory created with schema.ts placeholder
    .gitignore updated to exclude auto-generated Convex files
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Docker Compose configuration and Convex project structure</what-built>
  <how-to-verify>
    1. Generate admin key: openssl rand -hex 32
    2. Create .env file: cp .env.example .env and paste the generated key
    3. Start Docker services: docker-compose up -d
    4. Verify containers: docker-compose ps (should show 2 running services)
    5. Test backend: curl http://localhost:3210 (should respond, may return 404 which is expected)
    6. Access dashboard: Open http://localhost:6791 in browser
    7. Login to dashboard: Enter admin key from .env
    8. Confirm: Dashboard loads and shows "No functions deployed" or similar empty state

    If any step fails:
    - Check docker-compose logs: docker-compose logs
    - Verify ports are available: lsof -i :3210 and lsof -i :3211 and lsof -i :6791
    - Stop and retry: docker-compose down && docker-compose up -d
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] docker-compose.yml created and validates successfully
- [ ] convex/ directory created with schema.ts placeholder
- [ ] Docker services start successfully (docker-compose ps shows 2 running)
- [ ] Convex dashboard accessible at http://localhost:6791
- [ ] Backend responds at http://localhost:3210
</verification>

<success_criteria>

- All three tasks completed
- Docker Compose services running
- Convex dashboard accessible and login works
- Project ready for Phase 2 (Convex Schema definition)
  </success_criteria>

<output>
After completion, create `.planning/phases/01-project-setup/01-02-SUMMARY.md`:

# Phase 1 Plan 2: Docker Compose + Convex Setup Summary

**Self-hosted Convex backend running locally via Docker Compose.**

## Accomplishments

- Created docker-compose.yml with Convex backend and dashboard services
- Generated admin key for dashboard authentication
- Started Docker Compose services (backend on 3210/3211, dashboard on 6791)
- Created convex/ directory structure with schema.ts placeholder
- Verified Convex dashboard accessible and functional

## Files Created/Modified

- `docker-compose.yml` - Docker services definition
- `.env` - Admin key for dashboard authentication
- `.env.example` - Environment variable template
- `convex/schema.ts` - Placeholder schema (Phase 2 will define tables)
- `.gitignore` - Updated to exclude .env, convex_data/, convex/_generated/

## Decisions Made

- Self-hosted Convex over Convex Cloud for local development
- SQLite via Docker volume for data persistence (simplest for POC)
- Port 3210/3211 for backend, 6791 for dashboard (standard Convex ports)
- Empty schema for now, Phase 2 will define agentSessions and workflows tables

## Issues Encountered

[Or "None" - e.g., "Port 3210 already in use, resolved by stopping conflicting service"]

## Next Phase Readiness

Phase 1 complete. Ready for Phase 2: Convex Schema & State Model.

Convex backend is running and accessible. Schema placeholder created. Next phase will define agentSessions and workflows tables as documented in 02-RESEARCH.md.
</output>
