---
phase: 06-reviewer-agent
plan: 01
type: execute
---

<objective>
Create ReviewerAgent that validates implementations with structured output and Convex workflow integration.

Purpose: Provide a validation-focused agent that reviews code changes and produces structured feedback with issue tracking, completing the validation capability needed for the multi-agent workflow.

Output: Working ReviewerAgent class with ReviewResult interface, comprehensive tests, and documentation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Auto-selected based on dependency graph (from frontmatter):
@.planning/phases/03-agent-foundation/03-01-SUMMARY.md
@.planning/phases/04-planner-agent/04-01-SUMMARY.md
@.planning/phases/05-coder-agent/05-01-SUMMARY.md

# Key files from frontmatter (relevant to this phase):
@src/agents/BaseAgent.ts
@src/agents/PlannerAgent.ts
@src/agents/CoderAgent.ts
@src/types/plan.ts
@src/types/code.ts
@src/types/agent.ts

**Tech stack available:** [@anthropic-ai/claude-agent-sdk, Convex helper functions pattern, abstract BaseAgent with hooks, public API with v.* validators]
**Established patterns:** [BaseAgent extension pattern (getSystemPrompt only), domain-specific execute methods (executePlan, executeCode), hooks for session tracking, JSON extraction from markdown code blocks, comprehensive validation helpers]
**Constraining decisions:**
- [Phase 03-01]: Abstract BaseAgent class with protected Convex integration methods (SDK + Convex pattern)
- [Phase 03-01]: SessionStart/SessionEnd hooks for automatic state persistence (manual trigger pattern)
- [Phase 03-01]: Subclasses implement only getSystemPrompt() - BaseAgent handles all Convex details
- [Phase 04-01]: Use domain-specific execute method (executePlan vs execute) to avoid BaseAgent signature conflict
- [Phase 05-01]: Use domain-specific execute method (executeCode vs execute) to avoid BaseAgent signature conflict
- [Phase 05-01]: Follow exact same pattern as PlannerAgent for maintainability

**Issues being addressed:** None

**Concerns being verified:** None
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define ReviewResult and ReviewIssue interfaces</name>
  <files>src/types/review.ts</files>
  <action>Create ReviewResult interface in src/types/review.ts with:
- ReviewIssue interface: severity ('error' | 'warning' | 'info'), file (string), line (number), message (string), suggestion (string)
- ReviewResult interface: issues (ReviewIssue[]), summary (string), overallStatus ('approved' | 'needs-changes' | 'rejected'), filesReviewed (string[])
- Add helper function validateReviewResult() that checks: issues array exists, 0-20 items max, each issue has required fields, severity is valid, no duplicate (file, line, message) triples
- Export types from src/types/index.ts if it exists, otherwise export directly from review.ts
Follow pattern from src/types/plan.ts and src/types/code.ts (similar validation pattern)</action>
  <verify>TypeScript compilation passes, can import { ReviewResult, ReviewIssue, validateReviewResult } from src/types/review.js</verify>
  <done>ReviewResult interface defined with validation helper, all TypeScript compilation succeeds</done>
</task>

<task type="auto">
  <name>Task 2: Create ReviewerAgent class extending BaseAgent</name>
  <files>src/agents/ReviewerAgent.ts</files>
  <action>Create ReviewerAgent class in src/agents/ReviewerAgent.ts:
- Extend BaseAgent (follow PlannerAgent and CoderAgent pattern from Phases 4-5)
- Implement getSystemPrompt() returning prompt focused on code review: "You are a code reviewer. Validate implementations against requirements, identify issues, and provide structured feedback with severity levels."
- Add executeReview() method (not execute() to avoid BaseAgent signature conflict):
  - Accepts prompt string, optional ReviewOptions { maxIssues?: number, severity?: 'error' | 'warning' | 'info' }
  - Calls BaseAgent.execute() internally
  - Returns Promise<ReviewResult>
  - Uses parseReviewResult() to extract JSON from markdown code blocks (same pattern as PlannerAgent/CoderAgent)
  - Validates result using validateReviewResult()
  - Throws error if validation fails
- Add parseReviewResult() private method: extracts JSON from ```json blocks or plain text, handles parse errors
- Add validateReviewResult() private method: uses validation helper from types/review.ts
- Add executeWithWorkflow() for Convex workflow integration (same pattern as PlannerAgent and CoderAgent)
Follow exact pattern from PlannerAgent.ts and CoderAgent.ts but with review-focused prompts and ReviewResult type</action>
  <verify>TypeScript compilation passes, can import { ReviewerAgent } from src/agents/index.js</verify>
  <done>ReviewerAgent class created with executeReview(), parseReviewResult(), validateReviewResult(), executeWithWorkflow() methods</done>
</task>

<task type="auto">
  <name>Task 3: Export ReviewerAgent and create comprehensive tests</name>
  <files>src/agents/index.ts, tests/reviewer.test.ts</files>
  <action>
1. Update src/agents/index.ts:
   - Export ReviewerAgent class
   - Export ReviewerConfig type (extends AgentConfig with maxIssues, severity)

2. Create tests/reviewer.test.ts with comprehensive tests (follow pattern from tests/planner.test.ts and tests/coder.test.ts):
   - Mock SDK calls to avoid real API usage (same pattern as planner.test.ts and coder.test.ts)
   - Tests for instantiation (config, agentType, workflowId, model)
   - Tests for system prompt content (checks for "code reviewer", "severity levels")
   - Tests for executeReview() parsing JSON from markdown blocks
   - Tests for executeReview() parsing JSON from plain text
   - Tests for validateReviewResult() accepting valid reviews
   - Tests for validateReviewResult() rejecting invalid severity
   - Tests for validateReviewResult() enforcing 0-20 issues limit
   - Tests for validateReviewResult() rejecting duplicate (file, line, message) triples
   - Tests for executeWithWorkflow() with workflowId
   - Tests for overallStatus logic (approved vs needs-changes vs rejected)
   - Mock Convex client for workflow tests
   - Total: ~30-35 tests covering all code paths

Use vi.mock() for @anthropic-ai/claude-agent-sdk and convex client (same as planner.test.ts and coder.test.ts)
</action>
  <verify>npm test passes for reviewer.test.ts, all tests pass, no TypeScript errors</verify>
  <done>30-35 tests created covering instantiation, parsing, validation, workflow integration, all passing</done>
</task>

<task type="auto">
  <name>Task 4: Document ReviewerAgent usage in README</name>
  <files>src/agents/README.md</files>
  <action>Update src/agents/README.md:
- Add ReviewerAgent section after CoderAgent
- Document ReviewerConfig options (maxIssues, severity)
- Show usage example: const reviewer = new ReviewerAgent({ agentType: "reviewer" })
- Show executeReview() usage with code to review
- Show ReviewResult structure (issues, summary, overallStatus, filesReviewed)
- Show ReviewIssue structure (severity, file, line, message, suggestion)
- Show workflow integration example with executeWithWorkflow()
- Update comparison table: PlannerAgent (task decomposition) vs CoderAgent (code implementation) vs ReviewerAgent (validation)
Follow same format as PlannerAgent and CoderAgent documentation in current README
</action>
  <verify>README.md includes ReviewerAgent section with examples, compiles without errors</verify>
  <done>README.md updated with ReviewerAgent documentation following PlannerAgent/CoderAgent pattern</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm test` passes all tests (existing + new reviewer tests)
- [ ] No TypeScript errors
- [ ] ReviewerAgent can be imported from src/agents/index.js
- [ ] ReviewResult types can be imported from src/types/review.js
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- ReviewerAgent follows same patterns as PlannerAgent and CoderAgent
- Tests cover all code paths
  </success_criteria>

<output>
After completion, create `.planning/phases/06-reviewer-agent/06-01-SUMMARY.md`:

# Phase 6 Plan 1: Reviewer Agent Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description
- `path/to/another.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 6 complete. Ready for Phase 7: Orchestration.
</output>
