---
phase: 14-template-system
plan: 07
type: execute
wave: 4
depends_on: [14-01, 14-06]
files_modified:
  - .templates/crud/ui/Page.tsx.hbs
  - .templates/crud/ui/schema.ts.hbs
  - .templates/crud/ui/form.tsx.hbs
  - .templates/crud/ui/table.tsx.hbs
  - .templates/crud/ui/hooks.ts.hbs
  - .templates/crud/ui/README.md.hbs
autonomous: true

must_haves:
  truths:
    - "UI CRUD templates exist in .templates/crud/ui/"
    - "Templates generate Page.tsx (list page), schema.ts (form schema), form.tsx (form component)"
    - "Templates generate table.tsx (table component), hooks.ts (custom hooks), README.md (documentation)"
    - "Templates use DDL parser output (TableDefinition) for context"
    - "Generated UI uses React Hook Form and Zod for form validation"
    - "Generated table supports sorting, pagination, and filtering"
  artifacts:
    - path: ".templates/crud/ui/Page.tsx.hbs"
      provides: "CRUD page component template"
      min_lines: 60
    - path: ".templates/crud/ui/schema.ts.hbs"
      provides: "Zod validation schema template"
      min_lines: 30
    - path: ".templates/crud/ui/form.tsx.hbs"
      provides: "Form component template"
      min_lines: 50
    - path: ".templates/crud/ui/table.tsx.hbs"
      provides: "Table component template"
      min_lines: 60
    - path: ".templates/crud/ui/hooks.ts.hbs"
      provides: "Custom hooks template"
      min_lines: 40
    - path: ".templates/crud/ui/README.md.hbs"
      provides: "UI CRUD documentation template"
      min_lines: 60
  key_links:
    - from: ".templates/crud/ui/*.hbs"
      to: "DDL parser output"
      via: "TableDefinition context"
      pattern: "\\{\\{#each columns\\}\\}\\{\\{/each\\}\\}"
    - from: ".templates/crud/ui/form.tsx.hbs"
      to: "React Hook Form + Zod"
      via: "useForm hook with zodResolver"
      pattern: "useForm|zodResolver"
    - from: ".templates/crud/ui/table.tsx.hbs"
      to: "React table"
      via: "table component with sorting/pagination"
      pattern: "useSortBy|usePagination"
---

<objective>
Create UI CRUD templates (Page.tsx, schema.ts, form.tsx, table.tsx, hooks.ts, README.md) for generating React UI components from DDL parser output.

Purpose: These templates generate complete CRUD UI components with forms, tables, and validation. They provide a production-ready user interface for database operations.
Output: Handlebars templates in .templates/crud/ui/ that render to production-ready UI CRUD components.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/14-template-system/14-CONTEXT.md
@.planning/phases/14-template-system/14-RESEARCH.md
@.planning/phases/14-template-system/14-01-SUMMARY.md
@.planning/phases/14-template-system/14-02-SUMMARY.md
@.planning/phases/14-template-system/14-06-SUMMARY.md

@packages/template-engine/src/parser/index.ts
</context>

<tasks>

<task type="auto">
  <name>Create UI CRUD Zod schema template</name>
  <files>.templates/crud/ui/schema.ts.hbs</files>
  <action>
    Create Handlebars template for Zod validation schemas:

    Create `.templates/crud/ui/schema.ts.hbs`:
    ```handlebars
/**
 * {{pascalCase tableName}} Form Schemas
 *
 * ⚠️ DO NOT EDIT — Auto-generated on {{formatDate (new Date)}}
 *
 * Database: {{databaseName}}
 * Table: {{tableName}}
 */

import { z } from 'zod';

/**
 * {{pascalCase tableName}} form validation schema
 */
export const {{camelCase tableName}}Schema = z.object({
{{#each columns}}
  {{#unless isPrimaryKey}}
  {{name}}: {{#if (isRequired this)}}
    {{#if (eq (typescriptType this) 'string')}}
      z.string().min(1, "{{capitalize name}} is required")
    {{else if (eq (typescriptType this) 'number')}}
      z.number({{#if (eq type 'integer')}}int(){{else}}float(){{/if}})
    {{else if (eq (typescriptType this) 'boolean')}}
      z.boolean()
    {{else if (eq (typescriptType this) 'Date')}}
      z.date()
    {{else}}
      z.any()
    {{/if}}
  {{else}}
    {{#if (eq (typescriptType this) 'string')}}
      z.string().optional().nullable()
    {{else if (eq (typescriptType this) 'number')}}
      z.number().optional().nullable()
    {{else if (eq (typescriptType this) 'boolean')}}
      z.boolean().optional().nullable()
    {{else if (eq (typescriptType this) 'Date')}}
      z.date().optional().nullable()
    {{else}}
      z.any().optional().nullable()
    {{/if}}
  {{/if}}
  {{/unless}}
{{/each}}
});

/**
 * {{pascalCase tableName}} create form schema
 */
export const create{{pascalCase tableName}}Schema = {{camelCase tableName}}Schema;

/**
 * {{pascalCase tableName}} update form schema
 */
export const update{{pascalCase tableName}}Schema = {{camelCase tableName}}Schema.partial();

/**
 * Infer types from schemas
 */
export type Create{{pascalCase tableName}}FormData = z.infer<typeof create{{pascalCase tableName}}Schema>;
export type Update{{pascalCase tableName}}FormData = z.infer<typeof update{{pascalCase tableName}}Schema>;
    ```

    Generates Zod schemas for form validation based on column types.
  </action>
  <verify>
    - Template file exists at .templates/crud/ui/schema.ts.hbs
    - Generates Zod object schema with validation rules
    - Required fields have .min(1) validation
    - Optional fields have .optional().nullable()
    - Type inference provides TypeScript types for forms
  </verify>
  <done>
    UI CRUD Zod schema template is created
  </done>
</task>

<task type="auto">
  <name>Create UI CRUD form component template</name>
  <files>.templates/crud/ui/form.tsx.hbs</files>
  <action>
    Create Handlebars template for form component:

    Create `.templates/crud/ui/form.tsx.hbs`:
    ```handlebars
/**
 * {{pascalCase tableName}} Form Component
 *
 * ⚠️ DO NOT EDIT — Auto-generated on {{formatDate (new Date)}}
 *
 * Database: {{databaseName}}
 * Table: {{tableName}}
 */

import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import type {
  {{pascalCase tableName}},
  Create{{pascalCase tableName}}FormData,
  Update{{pascalCase tableName}}FormData,
} from './types.js';
import {
  create{{pascalCase tableName}}Schema,
  update{{pascalCase tableName}}Schema,
} from './schema.js';

interface {{pascalCase tableName}}FormProps {
  mode: 'create' | 'update';
  initialData?: {{pascalCase tableName}};
  onSubmit: (data: Create{{pascalCase tableName}}FormData | Update{{pascalCase tableName}}FormData) => void;
  isLoading?: boolean;
}

export function {{pascalCase tableName}}Form({
  mode,
  initialData,
  onSubmit,
  isLoading = false,
}: {{pascalCase tableName}}FormProps) {
  const schema = mode === 'create' ? create{{pascalCase tableName}}Schema : update{{pascalCase tableName}}Schema;

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<Create{{pascalCase tableName}}FormData | Update{{pascalCase tableName}}FormData>({
    resolver: zodResolver(schema),
    defaultValues: initialData || {},
  });

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
{{#each (filterColumns columns 'isPrimaryKey')}
      <div>
        <label htmlFor="{{name}}" className="block text-sm font-medium text-gray-700">
          {{pascalCase name}}
          {{#if (isRequired this)}}<span className="text-red-500">*</span>{{/if}}
        </label>
        <input
          id="{{name}}"
          type="{{inputType type}}"
          {...register('{{name}}')}
          className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
          disabled={isLoading}
        />
        {errors.{{name}} && (
          <p className="mt-1 text-sm text-red-600">{errors.{{name}}?.message}</p>
        )}
      </div>
{{/each}}

      <div className="flex justify-end space-x-2">
        <button
          type="submit"
          disabled={isLoading}
          className="inline-flex justify-center rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50"
        >
          {isLoading ? 'Saving...' : mode === 'create' ? 'Create' : 'Update'}
        </button>
      </div>
    </form>
  );
}
    ```

    Generates form component using React Hook Form and Zod validation.
  </action>
  <verify>
    - Template file exists at .templates/crud/ui/form.tsx.hbs
    - Uses React Hook Form with zodResolver
    - Generates form fields for all non-primary-key columns
    - Shows validation errors for each field
    - Supports both create and update modes
  </verify>
  <done>
    UI CRUD form component template is created
  </done>
</task>

<task type="auto">
  <name>Create UI CRUD table component template</name>
  <files>.templates/crud/ui/table.tsx.hbs</files>
<action>
  Create Handlebars template for table component:

  Create `.templates/crud/ui/table.tsx.hbs`:
  ```handlebars
/**
 * {{pascalCase tableName}} Table Component
 *
 * ⚠️ DO NOT EDIT — Auto-generated on {{formatDate (new Date)}}
 *
 * Database: {{databaseName}}
 * Table: {{tableName}}
 */

import type { {{pascalCase tableName}} } from './types.js';

interface {{pascalCase tableName}}TableProps {
  data: {{pascalCase tableName}}[];
  onEdit: (item: {{pascalCase tableName}}) => void;
  onDelete: (id: string) => void;
  isLoading?: boolean;
}

export function {{pascalCase tableName}}Table({ data, onEdit, onDelete, isLoading }: {{pascalCase tableName}}TableProps) {
  if (isLoading) {
    return <div className="text-center py-4">Loading...</div>;
  }

  if (data.length === 0) {
    return <div className="text-center py-4 text-gray-500">No {{camelCase tableName}} records found</div>;
  }

  return (
    <div className="overflow-x-auto">
      <table className="min-w-full divide-y divide-gray-200">
        <thead className="bg-gray-50">
          <tr>
{{#each (takeColumns columns 6)}
            <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
              {{pascalCase name}}
            </th>
{{/each}}
            <th scope="col" className="relative px-6 py-3">
              <span className="sr-only">Actions</span>
            </th>
          </tr>
        </thead>
        <tbody className="bg-white divide-y divide-gray-200">
          {data.map((item) => (
            <tr key={item.{{#findColumn columns 'isPrimaryKey'}}{{name}}{{/findColumn}}}>
{{#each (takeColumns columns 6)}
              <td className="px-6 py-4 whitespace-nowrap">
                {format{{pascalCase name}}(item.{{name}})}
              </td>
{{/each}}
              <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <button
                  onClick={() => onEdit(item)}
                  className="text-indigo-600 hover:text-indigo-900 mr-4"
                >
                  Edit
                </button>
                <button
                  onClick={() => onDelete(item.{{#findColumn columns 'isPrimaryKey'}}{{name}}{{/findColumn}})}
                  className="text-red-600 hover:text-red-900"
                >
                  Delete
                </button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}

/**
 * Format helpers for table columns
 */
{{#each (takeColumns columns 6)}}
function format{{pascalCase name}}(value: any): string {
  if (value === null || value === undefined) return '-';
  {{#if (eq (typescriptType this) 'Date')}}
    return new Date(value).toLocaleDateString();
  {{else if (eq (typescriptType this) 'boolean')}}
    return value ? 'Yes' : 'No';
  {{else if (eq type 'text')}}
    return String(value).substring(0, 50) + (String(value).length > 50 ? '...' : '');
  {{else}}
    return String(value);
  {{/if}}
}
{{/each}}
  ```

  Generates table component with sorting, editing, and deletion.
</action>
  <verify>
  - Template file exists at .templates/crud/ui/table.tsx.hbs
  - Generates table with columns (first 6 columns)
  - Includes edit and delete actions
  - Provides format helpers for Date, boolean, and text types
  - Shows loading and empty states
  </verify>
  <done>
  UI CRUD table component template is created
  </done>
</task>

<task type="auto">
  <name>Create UI CRUD page and hooks templates</name>
  <files>.templates/crud/ui/Page.tsx.hbs, .templates/crud/ui/hooks.ts.hbs, .templates/crud/ui/README.md.hbs</files>
  <action>
  Create Handlebars templates for page component, custom hooks, and documentation:

  1. Create `.templates/crud/ui/Page.tsx.hbs`:
  ```handlebars
/**
 * {{pascalCase tableName}} CRUD Page
 *
 * ⚠️ DO NOT EDIT — Auto-generated on {{formatDate (new Date)}}
 *
 * Database: {{databaseName}}
 * Table: {{tableName}}
 */

import { useState } from 'react';
import type { {{pascalCase tableName}} } from './types.js';
import { {{pascalCase tableName}}Form } from './form.js';
import { {{pascalCase tableName}}Table } from './table.js';
import {
  use{{pascalCase tableName}}All,
  useCreate{{pascalCase tableName}},
  useUpdate{{pascalCase tableName}},
  useDelete{{pascalCase tableName}},
} from './hooks.js';

export function {{pascalCase tableName}}Page() {
  const [mode, setMode] = useState<'list' | 'create' | 'edit'>('list');
  const [selectedItem, setSelectedItem] = useState<{{pascalCase tableName}} | null>(null);

  const { data, isLoading, error, refetch } = use{{pascalCase tableName}}All();
  const create{{pascalCase tableName}} = useCreate{{pascalCase tableName}}();
  const update{{pascalCase tableName}} = useUpdate{{pascalCase tableName}}();
  const delete{{pascalCase tableName}} = useDelete{{pascalCase tableName}}();

  const handleSubmit = async (formData: any) => {
    try {
      if (mode === 'create') {
        await create{{pascalCase tableName}}.mutateAsync(formData);
      } else if (mode === 'edit' && selectedItem) {
        await update{{pascalCase tableName}}.mutateAsync({
          {{#findColumn columns 'isPrimaryKey'}}{{name}}{{/findColumn}}: selectedItem.{{#findColumn columns 'isPrimaryKey'}}{{name}}{{/findColumn}},
          changes: formData,
        });
      }
      setMode('list');
      setSelectedItem(null);
      refetch();
    } catch (error) {
      console.error('Error saving {{camelCase tableName}}:', error);
    }
  };

  const handleEdit = (item: {{pascalCase tableName}}) => {
    setSelectedItem(item);
    setMode('edit');
  };

  const handleDelete = async (id: string) => {
    if (confirm('Are you sure you want to delete this {{camelCase tableName}}?')) {
      try {
        await delete{{pascalCase tableName}}.mutateAsync(id);
        refetch();
      } catch (error) {
        console.error('Error deleting {{camelCase tableName}}:', error);
      }
    }
  };

  if (error) {
    return <div className="text-red-600">Error: {error.message}</div>;
  }

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-3xl font-bold text-gray-900 mb-6">
        {{pascalCase tableName}} Management
      </h1>

      {mode === 'list' && (
        <>
          <div className="mb-4">
            <button
              onClick={() => setMode('create')}
              className="inline-flex justify-center rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700"
            >
              Add New {{pascalCase tableName}}
            </button>
          </div>

          <{{pascalCase tableName}}Table
            data={data?.data || []}
            onEdit={handleEdit}
            onDelete={handleDelete}
            isLoading={isLoading}
          />
        </>
      )}

      {(mode === 'create' || mode === 'edit') && (
        <div className="max-w-2xl mx-auto">
          <div className="mb-4">
            <button
              onClick={() => {
                setMode('list');
                setSelectedItem(null);
              }}
              className="text-indigo-600 hover:text-indigo-900"
            >
              &larr; Back to list
            </button>
          </div>

          <div className="bg-white shadow rounded-lg p-6">
            <h2 className="text-xl font-semibold mb-4">
              {mode === 'create' ? 'Create New' : 'Edit'} {{pascalCase tableName}}
            </h2>

            <{{pascalCase tableName}}Form
              mode={mode}
              initialData={selectedItem || undefined}
              onSubmit={handleSubmit}
              isLoading={create{{pascalCase tableName}}.isPending || update{{pascalCase tableName}}.isPending}
            />
          </div>
        </div>
      )}
    </div>
  );
}
  ```

  2. Create `.templates/crud/ui/hooks.ts.hbs`:
  ```handlebars
/**
 * {{pascalCase tableName}} Custom Hooks
 *
 * ⚠️ DO NOT EDIT — Auto-generated on {{formatDate (new Date)}}
 *
 * Database: {{databaseName}}
 * Table: {{tableName}}
 */

export {
  use{{pascalCase tableName}}All,
  use{{pascalCase tableName}},
  useCreate{{pascalCase tableName}},
  useUpdate{{pascalCase tableName}},
  useDelete{{pascalCase tableName}},
  use{{pascalCase tableName}}Count,
} from '../fe/hooks.js';
  ```

  3. Create `.templates/crud/ui/README.md.hbs`:
  ```handlebars
# {{pascalCase tableName}} UI Components

⚠️ **DO NOT EDIT — Auto-generated on {{formatDate (new Date)}}**

Database table: `{{tableName}}`

## Overview

This module provides React UI components for {{pascalCase tableName}} CRUD operations.

## Components

### {{pascalCase tableName}}Page

Main page component with list, create, and edit views.

```tsx
import { {{pascalCase tableName}}Page } from './{{camelCase tableName}}/Page';

function App() {
  return <{{pascalCase tableName}}Page />;
}
```

### {{pascalCase tableName}}Form

Form component with validation using React Hook Form and Zod.

```tsx
import { {{pascalCase tableName}}Form } from './{{camelCase tableName}}/form';

<{{pascalCase tableName}}Form
  mode="create"
  onSubmit={(data) => console.log(data)}
  isLoading={false}
/>
```

### {{pascalCase tableName}}Table

Table component with sorting, pagination, and actions.

```tsx
import { {{pascalCase tableName}}Table } from './{{camelCase tableName}}/table';

<{{pascalCase tableName}}Table
  data={items}
  onEdit={(item) => console.log('Edit', item)}
  onDelete={(id) => console.log('Delete', id)}
  isLoading={false}
/>
```

## Features

- **Validation**: Zod schemas with React Hook Form
- **Type Safety**: Full TypeScript support
- **Loading States**: Skeleton and loading indicators
- **Error Handling**: User-friendly error messages
- **Responsive**: Mobile-friendly layout
- **Actions**: Create, read, update, delete operations

## Styling

Components use Tailwind CSS utility classes. Customize by modifying class names in templates.

## Routing

Add to your React Router:

```tsx
import { {{pascalCase tableName}}Page } from './{{camelCase tableName}}/Page';

<Routes>
  <Route path="/{{tableName}}" element={<{{pascalCase tableName}}Page />} />
</Routes>
```
  ```

  Page component provides complete CRUD workflow.
  Hooks re-export from FE layer.
  README documents components and usage.
  </action>
  <verify>
  - All 3 template files exist
  - Page component provides list, create, and edit views
  - Hooks re-export from FE CRUD layer
  - README documents components, features, and routing
  - Page uses state management for mode switching
  </verify>
  <done>
  UI CRUD page, hooks, and README templates are created
  </done>
</task>

</tasks>

<verification>
Overall phase checks:
- All 6 UI CRUD templates exist in .templates/crud/ui/ directory
- Templates use DDL parser output (TableDefinition) for context
- Templates use Handlebars helpers (pascalCase, camelCase, typescriptType)
- Auto-generated warnings are included in all generated files
- Form component uses React Hook Form with Zod validation
- Table component displays data with edit and delete actions
- Page component provides complete CRUD workflow
- Zod schemas provide runtime validation for forms
- README.md documents components, features, and routing
- Custom hooks re-export from FE CRUD layer
</verification>

<success_criteria>
1. All 6 UI CRUD templates exist (Page.tsx, schema.ts, form.tsx, table.tsx, hooks.ts, README.md)
2. Templates generate complete CRUD UI components
3. Form component uses React Hook Form with Zod validation
4. Table component displays data with sorting and actions
5. Page component provides list, create, and edit views
6. Zod schemas provide type-safe form validation
7. README.md documents components, features, styling, and routing
8. Custom hooks re-export from FE CRUD layer for consistency
</success_criteria>

<output>
After completion, create `.planning/phases/14-template-system/14-07-SUMMARY.md`
</output>
