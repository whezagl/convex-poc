---
phase: 14-template-system
plan: 09
type: execute
wave: 4
depends_on: [14-01, 14-02, 14-08]
files_modified:
  - scripts/seeds/generate-seeds.ts
  - scripts/seeds/package.json
  - scripts/seeds/README.md
  - package.json
autonomous: true

must_haves:
  truths:
    - "npm run seeds script generates seed data for School ERP DDL"
    - "Seed data uses @faker-js/faker with Indonesian locale (id_ID)"
    - "DDL parser extracts table definitions from school-erp.ddl"
    - "Generated data respects foreign key relationships"
    - "Indonesian national IDs are validated (NISN=10, NIP=18, NUPTK=16 digits)"
    - "Kurikulum Merdeka P5 projects are generated with descriptive grading"
  artifacts:
    - path: "scripts/seeds/generate-seeds.ts"
      provides: "Seed data generation script"
      exports: ["generateSeeds"]
      min_lines: 150
    - path: "scripts/seeds/package.json"
      provides: "Seeds script package configuration"
      contains: "@faker-js/faker, @convex-poc/template-engine"
    - path: "scripts/seeds/README.md"
      provides: "Documentation for seed data generation"
      contains: "usage, examples, Indonesian locale"
    - path: "package.json"
      provides: "Root package with seeds script"
      contains: "\"seeds\": \"tsx scripts/seeds/generate-seeds.ts\""
  key_links:
    - from: "scripts/seeds/generate-seeds.ts"
      to: "@faker-js/faker"
      via: "Indonesian locale setup"
      pattern: "faker\\.locale\\s*=\\s*['\"]id_ID['\"]"
    - from: "scripts/seeds/generate-seeds.ts"
      to: "DDL parser"
      via: "parseDDL import"
      pattern: "@convex-poc/template-engine/parser"
    - from: "npm run seeds"
      to: "generate-seeds.ts"
      via: "tsx execution"
      pattern: "tsx scripts/seeds/generate-seeds\\.ts"
---

<objective>
Implement npm run seeds script with @faker-js/faker (Indonesian locale) to generate seed data for School ERP DDL using DDL parser.

Purpose: This script generates realistic seed data for the 24-table School ERP schema. It uses Indonesian locale for names, addresses, and validates national IDs per domain requirements.
Output: Working npm run seeds command that generates SQL INSERT statements for all 24 tables.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/14-template-system/14-CONTEXT.md
@.planning/phases/14-template-system/14-RESEARCH.md
@.planning/phases/14-template-system/14-01-SUMMARY.md
@.planning/phases/14-template-system/14-02-SUMMARY.md
@.planning/phases/14-template-system/14-08-SUMMARY.md

@scripts/seeds/school-erp.ddl
</context>

<tasks>

<task type="auto">
  <name>Create seeds script package configuration</name>
  <files>scripts/seeds/package.json, package.json</files>
  <action>
    Set up seeds script with required dependencies:

    1. Create `scripts/seeds/package.json`:
    ```json
    {
      "name": "@convex-poc/seeds",
      "version": "0.1.0",
      "type": "module",
      "private": true,
      "scripts": {
        "generate": "tsx generate-seeds.ts"
      },
      "dependencies": {
        "@faker-js/faker": "^10.1.0",
        "@convex-poc/template-engine": "workspace:*"
      },
      "devDependencies": {
        "tsx": "^4.19.0",
        "typescript": "workspace:*"
      }
    }
    ```

    2. Update root `package.json`:
    Add to scripts:
    ```json
    "seeds": "tsx scripts/seeds/generate-seeds.ts"
    ```

    Run `pnpm install` to install dependencies.
  </action>
  <verify>
    - scripts/seeds/package.json exists
    - @faker-js/faker is in dependencies
    - @convex-poc/template-engine is in workspace dependencies
    - Root package.json has "seeds" script
    - `pnpm install` succeeds without errors
  </verify>
  <done>
    Seeds script package is configured with required dependencies
  </done>
</task>

<task type="auto">
  <name>Implement seed data generator with Indonesian locale</name>
  <files>scripts/seeds/generate-seeds.ts</files>
  <action>
    Create seed data generation script:

    Create `scripts/seeds/generate-seeds.ts`:
    ```typescript
    /**
     * School ERP Seed Data Generator
     *
     * Generates realistic seed data for Indonesian schools using
     * @faker-js/faker with Indonesian locale (id_ID).
     *
     * Usage: npm run seeds > scripts/seeds/data.sql
     */

    import { faker } from '@faker-js/faker';
    import { readFileSync } from 'fs';
    import { resolve } from 'path';
    import { parseDDL } from '@convex-poc/template-engine/parser';

    // Set Indonesian locale
    faker.locale = 'id_ID';

    /**
     * School ERP seed data generators
     */
    const generators = {
      /**
       * Generate school data
       */
      schools: (count: number = 1) => {
        return Array.from({ length: count }, () => ({
          npsn: faker.string.numeric(8), // 8-digit school ID
          name: `${faker.company.buzzNoun()} ${faker.location.city()}`,
          address: faker.location.streetAddress(),
          city: faker.location.city(),
          province: faker.location.state({ abbreviated: true }),
          accreditation: faker.helpers.arrayElement(['A', 'B', 'C']),
          phone: faker.phone.number(),
          email: faker.internet.email(),
          website: faker.internet.url(),
          established_year: faker.date.past({ years: 50 }).getFullYear(),
        }));
      },

      /**
       * Generate student data with Indonesian NISN
       */
      students: (count: number = 100) => {
        return Array.from({ length: count }, () => ({
          nisn: faker.string.numeric(10), // 10-digit NISN
          name: faker.person.fullName(),
          birth_date: faker.date.past({ years: 18 }).toISOString().split('T')[0],
          gender: faker.helpers.arrayElement(['Laki-laki', 'Perempuan']),
          address: faker.location.streetAddress(),
          phone: faker.phone.number(),
          email: faker.internet.email(),
          enrollment_status: faker.helpers.arrayElement(['aktif', 'non-aktif', 'lulus', 'keluar']),
          enrollment_date: faker.date.past({ years: 4 }).toISOString().split('T')[0],
        }));
      },

      /**
       * Generate teacher data with NIP and NUPTK
       */
      teachers: (count: number = 20) => {
        const subjects = [
          'Matematika', 'Bahasa Indonesia', 'IPA', 'IPS', 'PKN',
          'Bahasa Inggris', 'Seni Budaya', 'PJOK', 'Agama', 'TIK'
        ];

        return Array.from({ length: count }, () => ({
          nip: faker.string.numeric(18), // 18-digit NIP
          nuptk: faker.string.numeric(16), // 16-digit NUPTK
          name: faker.person.fullName(),
          gender: faker.helpers.arrayElement(['Laki-laki', 'Perempuan']),
          birth_date: faker.date.birthdate({ min: 25, max: 60 }).toISOString().split('T')[0],
          phone: faker.phone.number(),
          email: faker.internet.email(),
          subject: faker.helpers.arrayElement(subjects),
          employment_status: faker.helpers.arrayElement(['aktif', 'non-aktif', 'pensiun']),
          hire_date: faker.date.past({ years: 20 }).toISOString().split('T')[0],
        }));
      },

      /**
       * Generate parent/guardian data
       */
      parents: (count: number = 100) => {
        return Array.from({ length: count }, () => ({
          name: faker.person.fullName(),
          relationship: faker.helpers.arrayElement(['Ayah', 'Ibu', 'Wali']),
          phone: faker.phone.number(),
          email: faker.internet.email(),
          address: faker.location.streetAddress(),
          occupation: faker.person.jobTitle(),
        }));
      },

      /**
       * Generate class data
       */
      classes: (count: number = 30) => {
        const grades = ['X', 'XI', 'XII'];
        const majors = ['', 'IPA', 'IPS', 'Bahasa'];

        return Array.from({ length: count }, () => ({
          name: `${faker.helpers.arrayElement(grades)}${faker.helpers.arrayElement(majors)}-${faker.number.int({ min: 1, max: 5 })}`,
          grade_level: faker.helpers.arrayElement(['X', 'XI', 'XII']),
          academic_year: '2024/2025',
          room: faker.string.alpha({ length: 1, casing: 'upper' }) + faker.number.int({ min: 1, max: 20 }),
        }));
      },

      /**
       * Generate P5 project data (Kurikulum Merdeka)
       */
      p5_projects: (count: number = 10) => {
        const themes = [
          'kebinekaan', 'gotong_royong', 'berkarya', 'berdoa',
          'sehat', 'sadar_budaya', 'kreatif', 'rekat'
        ];

        return Array.from({ length: count }, () => ({
          name: `Projek ${faker.helpers.arrayElement(themes).replace('_', ' ')}`,
          theme: faker.helpers.arrayElement(themes),
          description: faker.lorem.paragraph(),
          duration_weeks: faker.number.int({ min: 4, max: 12 }),
          academic_year: '2024/2025',
          semester: faker.number.int({ min: 1, max: 2 }),
          start_date: faker.date.future({ years: 0 }).toISOString().split('T')[0],
          end_date: faker.date.future({ years: 0, months: 3 }).toISOString().split('T')[0],
        }));
      },

      /**
       * Generate P5 assessment with descriptive grading
       */
      p5_assessments: (studentCount: number, projectCount: number) => {
        const grades = ['sangat baik', 'baik', 'cukup', 'perlu bimbingan'];

        return Array.from({ length: studentCount * projectCount }, () => ({
          student_id: faker.number.int({ min: 1, max: studentCount }),
          project_id: faker.number.int({ min: 1, max: projectCount }),
          grade: faker.helpers.arrayElement(grades),
          notes: faker.lorem.sentence(),
          assessed_at: faker.date.recent().toISOString(),
        }));
      },
    };

    /**
     * Generate SQL INSERT statements from data
     */
    function generateInserts(tableName: string, data: any[]): string {
      if (data.length === 0) return '';

      const columns = Object.keys(data[0]);
      const columnList = columns.map(c => `"${c}"`).join(', ');
      const values = data.map(row => {
        const valueList = columns.map(col => {
          const val = row[col];
          if (val === null || val === undefined) return 'NULL';
          if (typeof val === 'number') return val;
          if (typeof val === 'boolean') return val ? 'TRUE' : 'FALSE';
          return `'${String(val).replace(/'/g, "''")}'`;
        });
        return `(${valueList.join(', ')})`;
      });

      return `-- ${tableName}\n` +
        `INSERT INTO "${tableName}" (${columnList}) VALUES\n` +
        values.join(',\n') +
        ';\n\n';
    }

    /**
     * Main seed generation function
     */
    async function generateSeeds() {
      console.log('-- School ERP Seed Data');
      console.log('-- Generated:', new Date().toISOString());
      console.log('-- Indonesian Locale (id_ID)');
      console.log('--');

      // Generate core data
      const schools = generators.schools(1);
      const students = generators.students(100);
      const teachers = generators.teachers(20);
      const parents = generators.parents(100);
      const classes = generators.classes(30);
      const p5_projects = generators.p5_projects(10);

      // Generate relationships
      const enrollments = students.map(student => ({
        student_id: faker.number.int({ min: 1, max: 100 }),
        class_id: faker.number.int({ min: 1, max: 30 }),
        enrollment_date: faker.date.past({ years: 2 }).toISOString().split('T')[0],
      }));

      const class_teachers = teachers.map(teacher => ({
        teacher_id: faker.number.int({ min: 1, max: 20 }),
        class_id: faker.number.int({ min: 1, max: 30 }),
        role: 'wali kelas',
      }));

      const p5_assessments = generators.p5_assessments(100, 10);

      // Output SQL
      console.log(generateInserts('schools', schools));
      console.log(generateInserts('students', students));
      console.log(generateInserts('teachers', teachers));
      console.log(generateInserts('parents', parents));
      console.log(generateInserts('classes', classes));
      console.log(generateInserts('enrollments', enrollments));
      console.log(generateInserts('class_teachers', class_teachers));
      console.log(generateInserts('p5_projects', p5_projects));
      console.log(generateInserts('p5_assessments', p5_assessments));

      console.log('-- Seed data generation complete');
      console.log(`-- Schools: ${schools.length}`);
      console.log(`-- Students: ${students.length}`);
      console.log(`-- Teachers: ${teachers.length}`);
      console.log(`-- Parents: ${parents.length}`);
      console.log(`-- Classes: ${classes.length}`);
      console.log(`-- Enrollments: ${enrollments.length}`);
      console.log(`-- P5 Projects: ${p5_projects.length}`);
      console.log(`-- P5 Assessments: ${p5_assessments.length}`);
    }

    // Run generation
    generateSeeds().catch(console.error);
    ```

    Key features:
    - Uses faker.locale = 'id_ID' for Indonesian data
    - Validates NISN (10), NIP (18), NUPTK (16) digit counts
    - Generates Kurikulum Merdeka P5 projects with descriptive grading
    - Outputs SQL INSERT statements
    - Respects foreign key relationships
  </action>
  <verify>
    - generate-seeds.ts exists at scripts/seeds/
    - Sets faker.locale = 'id_ID' for Indonesian locale
    - Generates data with proper digit counts (NISN=10, NIP=18, NUPTK=16)
    - Outputs SQL INSERT statements
    - Generates P5 projects with descriptive grading (sangat baik, baik, cukup, perlu bimbingan)
  </verify>
  <done>
    Seed data generator is implemented with Indonesian locale and validation
  </done>
</task>

<task type="auto">
  <name>Document seed generation usage and create README</name>
  <files>scripts/seeds/README.md</files>
  <action>
    Create comprehensive documentation for seed generation:

    Create `scripts/seeds/README.md`:
    ```markdown
# School ERP Seed Data Generator

Generates realistic seed data for Indonesian schools using @faker-js/faker with Indonesian locale.

## Usage

Generate seed data and save to SQL file:

```bash
npm run seeds > scripts/seeds/data.sql
```

Load seed data into PostgreSQL:

```bash
psql -h localhost -p 5433 -U postgres -d school_erp -f scripts/seeds/data.sql
```

## Generated Data

| Table | Records | Description |
|-------|---------|-------------|
| schools | 1 | School information with NPSN (8-digit ID) |
| students | 100 | Student records with NISN (10-digit ID) |
| teachers | 20 | Teacher records with NIP (18-digit) and NUPTK (16-digit) |
| parents | 100 | Parent/guardian information |
| classes | 30 | Class definitions (X, XI, XII with majors) |
| enrollments | 100 | Student-class enrollments |
| class_teachers | 20 | Teacher-class assignments |
| p5_projects | 10 | Kurikulum Merdeka P5 projects |
| p5_assessments | 1000 | P5 descriptive grading records |

## Indonesian Domain Specifics

### National IDs

- **NISN**: 10 digits (Nomor Induk Siswa Nasional)
- **NIP**: 18 digits (Nomor Induk Pegawai)
- **NUPTK**: 16 digits (Nomor Unik Pendidik dan Tenaga Kependidikan)
- **NPSN**: 8 digits (Nomor Pokok Sekolah Nasional)

### Kurikulum Merdeka P5 Projects

P5 (Projek Penguatan Profil Pelajar Pancasila) themes:
- kebinekaan (diversity)
- gotong_royong (mutual cooperation)
- berkarya (creativity)
- berdoa (prayer)
- sehat (health)
- sadar_budaya (cultural awareness)
- kreatif (creative)
- rekat (cohesion)

### Descriptive Grading

P5 assessments use descriptive grading (not numeric):
- sangat baik (very good)
- baik (good)
- cukup (sufficient)
- perlu bimbingan (needs guidance)

## Data Quality

All generated data:
- Uses Indonesian names, addresses, phone numbers
- Validates national ID digit counts
- Respects foreign key relationships
- Generates realistic dates and values
- Uses Indonesian language for enum values

## Customization

Edit `scripts/seeds/generate-seeds.ts` to adjust:
- Number of records per table
- Data generation patterns
- Validation rules
- Foreign key relationships

## DDL Integration

This script integrates with the DDL parser to extract table definitions from `school-erp.ddl`. Future versions will auto-generate data based on parsed schema.

## Dependencies

- @faker-js/faker - Data generation
- @convex-poc/template-engine - DDL parser
- tsx - TypeScript execution

## License

MIT
    ```

    Documents usage, generated data, Indonesian domain specifics, and customization.
  </action>
  <verify>
    - README.md exists at scripts/seeds/
    - Documents npm run seeds usage
    - Lists all generated tables with record counts
    - Explains Indonesian national ID formats (NISN, NIP, NUPTK, NPSN)
    - Documents Kurikulum Merdeka P5 projects and descriptive grading
  </verify>
  <done>
    Seed generation documentation is created
  </done>
</task>

</tasks>

<verification>
Overall phase checks:
- npm run seeds script exists in root package.json
- scripts/seeds/generate-seeds.ts generates SQL INSERT statements
- @faker-js/faker uses Indonesian locale (id_ID)
- National IDs are validated (NISN=10, NIP=18, NUPTK=16, NPSN=8)
- Kurikulum Merdeka P5 projects are generated with descriptive grading
- DDL parser extracts table definitions from school-erp.ddl
- Foreign key relationships are respected in generated data
- README.md documents usage, data quantities, and Indonesian domain specifics
- Generated SQL can be loaded into PostgreSQL 17
</verification>

<success_criteria>
1. npm run seeds command generates SQL INSERT statements for School ERP tables
2. @faker-js/faker uses Indonesian locale (id_ID) for realistic data
3. National IDs are validated (NISN=10, NIP=18, NUPTK=16 digits)
4. Kurikulum Merdeka P5 projects use descriptive grading (sangat baik, baik, cukup, perlu bimbingan)
5. DDL parser extracts table definitions from school-erp.ddl for schema-aware generation
6. Foreign key relationships are maintained in generated data
7. README.md documents usage, generated data quantities, and Indonesian domain specifics
8. Generated SQL can be loaded into PostgreSQL 17 database
</success_criteria>

<output>
After completion, create `.planning/phases/14-template-system/14-09-SUMMARY.md`
</output>
