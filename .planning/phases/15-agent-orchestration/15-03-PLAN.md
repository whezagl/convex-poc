---
phase: 15-agent-orchestration
plan: 03
type: execute
wave: 2
depends_on: ["15-01", "15-02"]
files_modified:
  - packages/agent-orchestrator/src/agents/BEBoilerplateAgent.ts
  - packages/agent-orchestrator/src/agents/FEBoilerplateAgent.ts
  - packages/agent-orchestrator/src/agents/index.ts
autonomous: true

must_haves:
  truths:
    - "BE Boilerplate agent spawns 1 sub-task for backend project setup"
    - "FE Boilerplate agent spawns 1 sub-task for frontend project setup"
    - "Both agents use Phase 14 boilerplate templates (.templates/be/boilerplate, .templates/fe/boilerplate)"
    - "Agents generate project structure files (package.json, tsconfig.json, etc.)"
  artifacts:
    - path: "packages/agent-orchestrator/src/agents/BEBoilerplateAgent.ts"
      provides: "Backend boilerplate agent"
      exports: ["BEBoilerplateAgent"]
    - path: "packages/agent-orchestrator/src/agents/FEBoilerplateAgent.ts"
      provides: "Frontend boilerplate agent"
      exports: ["FEBoilerplateAgent"]
  key_links:
    - from: "BEBoilerplateAgent.ts"
      to: "./BaseCRUDAgent"
      via: "extends BaseCRUDAgent"
      pattern: "class BEBoilerplateAgent extends BaseCRUDAgent"
    - from: "FEBoilerplateAgent.ts"
      to: "./BaseCRUDAgent"
      via: "extends BaseCRUDAgent"
      pattern: "class FEBoilerplateAgent extends BaseCRUDAgent"
    - from: "BEBoilerplateAgent.ts"
      to: "@convex-poc/template-engine/engine"
      via: "import { TemplateEngine } from '@convex-poc/template-engine/engine'"
      pattern: "this\\.templateEngine\\.load"
---

<objective>
Implement BE and FE boilerplate agents that generate project structure using Phase 14 templates.

Purpose: Create 1 sub-task for backend setup and 1 sub-task for frontend setup, generating package.json, tsconfig.json, and other boilerplate files from templates.

Output: BEBoilerplateAgent and FEBoilerplateAgent classes extending BaseCRUDAgent.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/15-agent-orchestration/15-RESEARCH.md
@.planning/phases/15-agent-orchestration/15-CONTEXT.md
@.planning/phases/14-template-system/14-03-SUMMARY.md
@.planning/phases/14-template-system/14-04-SUMMARY.md
@packages/agent-orchestrator/src/agents/BaseCRUDAgent.ts
@packages/agent-orchestrator/src/agents/types.ts
@packages/template-engine/package.json
</context>

<tasks>

<task type="auto">
  <name>Implement BEBoilerplateAgent</name>
  <files>packages/agent-orchestrator/src/agents/BEBoilerplateAgent.ts</files>
  <action>
    Create BEBoilerplateAgent extending BaseCRUDAgent:

    ```typescript
    // @convex-poc/agent-orchestrator/agents/BEBoilerplateAgent - Backend boilerplate agent

    import { join } from "path";
    import type { AgentType } from "@convex-poc/shared-types/agent";
    import type { Id } from "@convex-poc/shared-types/subtask";
    import { BaseCRUDAgent, type CRUDAgentConfig, type TableDefinition } from "./BaseCRUDAgent.js";
    import type { TemplateType } from "./types.js";

    /**
     * BEBoilerplateAgent generates backend project structure.
     *
     * Spawns 1 sub-task that generates:
     * - package.json with Express 5.0.0, Zod 4.0.0, pg 8.13.0
     * - tsconfig.json with ES2022 target
     * - src/index.ts with Express server setup
     * - .env.example file
     * - README.md with setup instructions
     *
     * Templates: .templates/be/boilerplate/* (from Phase 14-03)
     */
    export class BEBoilerplateAgent extends BaseCRUDAgent {
      constructor(config: CRUDAgentConfig) {
        super(config);
      }

      /**
       * Selects the appropriate template for backend boilerplate.
       * Templates from Phase 14-03:
       * - package.json.hbs
       * - tsconfig.json.hbs
       * - src/index.ts.hbs
       * - .env.example.hbs
       * - README.md.hbs
       */
      protected selectTemplate(): string {
        // Returns base directory - agent will iterate through template files
        return "be/boilerplate";
      }

      /**
       * Prepares template variables for backend boilerplate.
       *
       * Variables for Phase 14-03 templates:
       * - projectName: From workspace path or default
       * - description: Optional project description
       * - dependencies: Fixed Express 5.0.0, Zod 4.0.0, pg 8.13.0
       * - typescriptTarget: Fixed "ES2022"
       * - port: Default 3000
       */
      protected async prepareTemplateVariables(): Promise<Record<string, unknown>> {
        const { workspacePath } = this.config;

        // Extract project name from workspace path
        const projectName = workspacePath.split("/").pop() || "backend-project";

        return {
          projectName,
          description: "Backend API generated by AI Agents POC",
          dependencies: {
            express: "^5.0.0",
            zod: "^4.0.0",
            pg: "^8.13.0",
            dotenv: "^16.0.0",
          },
          devDependencies: {
            typescript: "^5.9.3",
            "@types/node": "^25.0.9",
            "@types/express": "^5.0.0",
          },
          typescriptTarget: "ES2022",
          port: 3000,
          nodeVersion: "20",
        };
      }

      /**
       * Returns output path for generated backend files.
       *
       * Files are written to:
       * - workspacePath/package.json
       * - workspacePath/tsconfig.json
       * - workspacePath/src/index.ts
       * - workspacePath/.env.example
       * - workspacePath/README.md
       */
      protected getOutputPath(): string {
        // Base output directory - individual files handled by template engine
        return this.config.workspacePath;
      }

      /**
       * Overrides execute to handle multi-file boilerplate generation.
       * BE boilerplate generates 5 files from templates.
       */
      async execute(): Promise<void> {
        const { subTaskId, totalSteps } = this.config;

        try {
          // Step 1: Load templates (all 5 files)
          await this.updateProgress(1, "Loading backend boilerplate templates");

          const templateFiles = [
            "package.json.hbs",
            "tsconfig.json.hbs",
            "src/index.ts.hbs",
            ".env.example.hbs",
            "README.md.hbs",
          ];

          const templates = await Promise.all(
            templateFiles.map(file =>
              this.templateEngine.load(`be/boilerplate/${file}`)
            )
          );

          // Step 2: Prepare variables
          await this.updateProgress(2, "Preparing backend project variables");
          const variables = await this.prepareTemplateVariables();

          // Step 3: Generate code for all files
          await this.updateProgress(3, "Generating backend project files");
          const generatedFiles = templates.map((template, index) => ({
            template,
            outputPath: join(
              this.config.workspacePath,
              templateFiles[index].replace(".hbs", "")
            ),
            variables,
          }));

          // Step 4: Write files with locking
          await this.updateProgress(4, "Writing backend project files");
          for (const { template, outputPath, variables } of generatedFiles) {
            const code = this.templateEngine.render(template, variables);
            await this.writeWithLock(undefined, code, outputPath);
          }

          // Step 5: Complete
          await this.updateProgress(totalSteps, "Backend boilerplate generated", "done");

        } catch (error) {
          await this.handleExecutionError("backend boilerplate", error);
        }
      }

      /**
       * Overridden writeWithLock to support custom output paths.
       */
      protected async writeWithLock(
        _table: TableDefinition | undefined,
        content: string,
        customPath?: string
      ): Promise<void> {
        const outputPath = customPath || this.getOutputPath(_table);

        // Ensure parent directory exists
        await require("fs/promises").mkdir(
          require("path").dirname(outputPath),
          { recursive: true }
        );

        // Write with lock
        await this.lockManager.withLock(outputPath, async () => {
          await require("fs/promises").writeFile(outputPath, content, "utf-8");
        });
      }
    }
    ```

    Reference Phase 14-03 templates for exact variable names.
  </action>
  <verify>grep -q "class BEBoilerplateAgent" packages/agent-orchestrator/src/agents/BEBoilerplateAgent.ts</verify>
  <done>BEBoilerplateAgent implemented with 5-file boilerplate generation (package.json, tsconfig.json, src/index.ts, .env.example, README.md)</done>
</task>

<task type="auto">
  <name>Implement FEBoilerplateAgent</name>
  <files>packages/agent-orchestrator/src/agents/FEBoilerplateAgent.ts</files>
  <action>
    Create FEBoilerplateAgent extending BaseCRUDAgent:

    ```typescript
    // @convex-poc/agent-orchestrator/agents/FEBoilerplateAgent - Frontend boilerplate agent

    import { join } from "path";
    import type { CRUDAgentConfig, type TableDefinition } from "./BaseCRUDAgent.js";

    /**
     * FEBoilerplateAgent generates frontend project structure.
     *
     * Spawns 1 sub-task that generates:
     * - package.json with Vite 6, React 19, TypeScript
     * - tsconfig.json with ES2020 target
     * - vite.config.ts with React plugin
     * - src/main.tsx with React root
     * - src/App.tsx with basic routing
     * - index.html with Vite entry
     *
     * Templates: .templates/fe/boilerplate/* (from Phase 14-04)
     */
    export class FEBoilerplateAgent extends BaseCRUDAgent {
      constructor(config: CRUDAgentConfig) {
        super(config);
      }

      /**
       * Selects the appropriate template for frontend boilerplate.
       * Templates from Phase 14-04:
       * - package.json.hbs
       * - tsconfig.json.hbs
     * - vite.config.ts.hbs
       * - src/main.tsx.hbs
       * - src/App.tsx.hbs
       * - index.html.hbs
       */
      protected selectTemplate(): string {
        return "fe/boilerplate";
      }

      /**
       * Prepares template variables for frontend boilerplate.
       *
       * Variables for Phase 14-04 templates:
       * - projectName: From workspace path or default
       * - description: Optional project description
       * - dependencies: Vite 6, React 19, React Router 7, TanStack Query
       * - typescriptTarget: Fixed "ES2020"
       */
      protected async prepareTemplateVariables(): Promise<Record<string, unknown>> {
        const { workspacePath } = this.config;

        const projectName = workspacePath.split("/").pop() || "frontend-project";

        return {
          projectName,
          description: "Frontend UI generated by AI Agents POC",
          dependencies: {
            react: "^19.0.0",
            "react-dom": "^19.0.0",
            "react-router-dom": "^7.0.0",
            "@tanstack/react-query": "^5.0.0",
          },
          devDependencies: {
            vite: "^6.0.0",
            "@vitejs/plugin-react": "^4.0.0",
            typescript: "^5.9.3",
            "@types/react": "^19.0.0",
            "@types/react-dom": "^19.0.0",
          },
          typescriptTarget: "ES2020",
        };
      }

      /**
       * Returns output path for generated frontend files.
       */
      protected getOutputPath(): string {
        return this.config.workspacePath;
      }

      /**
       * Overrides execute to handle multi-file boilerplate generation.
       * FE boilerplate generates 6 files from templates.
       */
      async execute(): Promise<void> {
        const { subTaskId, totalSteps } = this.config;

        try {
          // Step 1: Load templates (all 6 files)
          await this.updateProgress(1, "Loading frontend boilerplate templates");

          const templateFiles = [
            "package.json.hbs",
            "tsconfig.json.hbs",
            "vite.config.ts.hbs",
            "src/main.tsx.hbs",
            "src/App.tsx.hbs",
            "index.html.hbs",
          ];

          const templates = await Promise.all(
            templateFiles.map(file =>
              this.templateEngine.load(`fe/boilerplate/${file}`)
            )
          );

          // Step 2: Prepare variables
          await this.updateProgress(2, "Preparing frontend project variables");
          const variables = await this.prepareTemplateVariables();

          // Step 3: Generate code
          await this.updateProgress(3, "Generating frontend project files");

          const generatedFiles = templates.map((template, index) => ({
            template,
            outputPath: join(
              this.config.workspacePath,
              templateFiles[index].replace(".hbs", "")
            ),
            variables,
          }));

          // Step 4: Write files
          await this.updateProgress(4, "Writing frontend project files");
          for (const { template, outputPath, variables } of generatedFiles) {
            const code = this.templateEngine.render(template, variables);
            await this.writeWithLock(undefined, code, outputPath);
          }

          // Step 5: Complete
          await this.updateProgress(totalSteps, "Frontend boilerplate generated", "done");

        } catch (error) {
          await this.handleExecutionError("frontend boilerplate", error);
        }
      }

      /**
       * Overridden writeWithLock to support custom output paths.
       */
      protected async writeWithLock(
        _table: TableDefinition | undefined,
        content: string,
        customPath?: string
      ): Promise<void> {
        const outputPath = customPath || this.getOutputPath(_table);

        await require("fs/promises").mkdir(
          require("path").dirname(outputPath),
          { recursive: true }
        );

        await this.lockManager.withLock(outputPath, async () => {
          await require("fs/promises").writeFile(outputPath, content, "utf-8");
        });
      }
    }
    ```

    Reference Phase 14-04 templates for exact variable names.
  </action>
  <verify>grep -q "class FEBoilerplateAgent" packages/agent-orchestrator/src/agents/FEBoilerplateAgent.ts</verify>
  <done>FEBoilerplateAgent implemented with 6-file boilerplate generation (package.json, tsconfig.json, vite.config.ts, src/main.tsx, src/App.tsx, index.html)</done>
</task>

<task type="auto">
  <name>Update agents barrel export</name>
  <files>packages/agent-orchestrator/src/agents/index.ts</files>
  <action>
    Update agents/index.ts to export boilerplate agents:

    ```typescript
    // @convex-poc/agent-orchestrator/agents - Agent exports

    export { BaseCRUDAgent } from "./BaseCRUDAgent.js";
    export { BEBoilerplateAgent } from "./BEBoilerplateAgent.js";
    export { FEBoilerplateAgent } from "./FEBoilerplateAgent.js";
    export * from "./types.js";
    ```
  </action>
  <verify>grep -q "BEBoilerplateAgent\|FEBoilerplateAgent" packages/agent-orchestrator/src/agents/index.ts</verify>
  <done>Agents module exports BEBoilerplateAgent and FEBoilerplateAgent</done>
</task>

</tasks>

<verification>
# Post-Execution Verification

## Build Check
- Run: `pnpm --filter @convex-poc/agent-orchestrator build`
- Expected: Clean compilation

## Template Check
```bash
ls .templates/be/boilerplate/
# Expected: package.json.hbs, tsconfig.json.hbs, src/index.ts.hbs, .env.example.hbs, README.md.hbs

ls .templates/fe/boilerplate/
# Expected: package.json.hbs, tsconfig.json.hbs, vite.config.ts.hbs, src/main.tsx.hbs, src/App.tsx.hbs, index.html.hbs
```

## Type Check
- BEBoilerplateAgent extends BaseCRUDAgent
- FEBoilerplateAgent extends BaseCRUDAgent
- Both override selectTemplate, prepareTemplateVariables, getOutputPath, execute
</verification>

<success_criteria>
1. BEBoilerplateAgent generates 5 backend boilerplate files from templates
2. FEBoilerplateAgent generates 6 frontend boilerplate files from templates
3. Both agents use Phase 14 templates (be/boilerplate/*, fe/boilerplate/*)
4. File locking prevents write conflicts during parallel execution
5. Progress updates stream to Convex for real-time UI feedback
</success_criteria>

<output>
After completion, create `.planning/phases/15-agent-orchestration/15-03-SUMMARY.md`
</output>
