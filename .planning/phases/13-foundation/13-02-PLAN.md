---
phase: 13-foundation
plan: 02
type: execute
wave: 2
depends_on: [13-01]
files_modified:
  - packages/shared-types/package.json
  - packages/shared-types/src/task.ts
  - packages/shared-types/src/subtask.ts
  - packages/shared-types/src/log.ts
  - packages/shared-types/src/agent.ts
  - packages/shared-types/src/template.ts
autonomous: true

must_haves:
  truths:
    - "TypeScript types from @convex-poc/shared-types are importable across workspace packages"
    - "Zod schemas are defined alongside TypeScript types for runtime validation"
    - "Union types are used for fixed values (not enums)"
  artifacts:
    - path: "packages/shared-types/package.json"
      provides: "Shared types package with exports"
      exports: ["./task", "./subtask", "./log", "./agent", "./template"]
    - path: "packages/shared-types/src/task.ts"
      provides: "Task type and TaskSchema Zod validation"
      exports: ["Task", "TaskSchema", "TaskStatus", "TaskPriority"]
    - path: "packages/shared-types/src/subtask.ts"
      provides: "SubTask type and SubTaskSchema Zod validation"
      exports: ["SubTask", "SubTaskSchema"]
    - path: "packages/shared-types/src/log.ts"
      provides: "Log type and LogSchema Zod validation"
      exports: ["Log", "LogSchema", "LogLevel"]
  key_links:
    - from: "packages/convex-client"
      to: "packages/shared-types"
      via: "import { Task } from '@convex-poc/shared-types/task'"
      pattern: "@convex-poc/shared-types/\\w+"
    - from: "any workspace package"
      to: "packages/shared-types"
      via: "package.json exports field"
      pattern: "workspace:\\*"
---

<objective>
Create @convex-poc/shared-types package with TypeScript types and Zod schemas for all domain entities.

Purpose: Centralized type definitions enable type-safe data flow across the entire mono-repo. Zod schemas provide runtime validation at Convex function boundaries.
Output: Shared types package importable from any workspace package.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/13-foundation/13-CONTEXT.md
@.planning/phases/13-foundation/13-RESEARCH.md
@.planning/REQUIREMENTS.md

@.planning/phases/13-foundation/13-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Create Task and SubTask types with Zod schemas</name>
  <files>packages/shared-types/src/task.ts, packages/shared-types/src/subtask.ts</files>
  <action>
    Create Task and SubTask types following CONTEXT.md decisions:

    **File: `packages/shared-types/src/task.ts`**
    ```typescript
    import { z } from "zod";

    // Union types (not enums) per CONTEXT.md decision
    export const TaskStatusSchema = z.union([
      z.literal("pending"),
      z.literal("running"),
      z.literal("paused"),
      z.literal("done"),
      z.literal("cancelled"),
    ]);

    export const TaskPrioritySchema = z.union([
      z.literal("low"),
      z.literal("medium"),
      z.literal("high"),
    ]);

    export const PauseReasonSchema = z.union([
      z.literal("user"),
      z.literal("auto"),
    ]);

    // TypeScript types derived from schemas
    export type TaskStatus = z.infer<typeof TaskStatusSchema>;
    export type TaskPriority = z.infer<typeof TaskPrioritySchema>;
    export type PauseReason = z.infer<typeof PauseReasonSchema>;

    // Document schema
    export const TaskSchema = z.object({
      _id: z.string(),
      title: z.string(),
      description: z.string().optional(),
      status: TaskStatusSchema,
      priority: TaskPrioritySchema,
      workspacePath: z.string().optional(),
      createdAt: z.number(),
      updatedAt: z.number(),
      // For pause state
      pauseReason: PauseReasonSchema.optional(),
    });

    export type Task = z.infer<typeof TaskSchema>;
    ```

    **File: `packages/shared-types/src/subtask.ts`**
    ```typescript
    import { z } from "zod";

    export const SubTaskStatusSchema = z.union([
      z.literal("pending"),
      z.literal("running"),
      z.literal("done"),
      z.literal("failed"),
    ]);

    export type SubTaskStatus = z.infer<typeof SubTaskStatusSchema>;

    export const SubTaskSchema = z.object({
      _id: z.string(),
      taskId: z.string(), // Reference to parent task
      title: z.string(),
      status: SubTaskStatusSchema,
      agentType: z.string(), // "BE Boilerplate", "BE CRUD APIs", etc.
      stepNumber: z.number(),
      totalSteps: z.number(),
      createdAt: z.number(),
      updatedAt: z.number(),
    });

    export type SubTask = z.infer<typeof SubTaskSchema>;
    ```

    Key decisions:
    - Use union types (literals) not enums - better serialization
    - Include pauseReason for two-pause state distinction (Phase 18)
    - SubTask has agentType for specialized CRUD agents
    - SubTask has stepNumber/totalSteps for progress tracking

    Add Zod as dependency: `pnpm add zod@workspace:*` in packages/shared-types
  </action>
  <verify>
    - Run `tsc --noEmit` in packages/shared-types - should compile without errors
    - Test Zod validation: create a test file that validates a Task object
    - Verify types are importable: `import { Task } from '@convex-poc/shared-types/task'`
  </verify>
  <done>
    Task and SubTask types are defined with Zod schemas and TypeScript types
  </done>
</task>

<task type="auto">
  <name>Create Log, Agent, and Template types with Zod schemas</name>
  <files>packages/shared-types/src/log.ts, packages/shared-types/src/agent.ts, packages/shared-types/src/template.ts</files>
  <action>
    Create remaining domain entity types:

    **File: `packages/shared-types/src/log.ts`**
    ```typescript
    import { z } from "zod";

    export const LogLevelSchema = z.union([
      z.literal("info"),
      z.literal("warning"),
      z.literal("error"),
    ]);

    export type LogLevel = z.infer<typeof LogLevelSchema>;

    export const LogSchema = z.object({
      timestamp: z.number(),
      message: z.string(),
      level: LogLevelSchema,
      source: z.string().optional(), // "agent" or "system"
    });

    export type Log = z.infer<typeof LogSchema>;
    ```

    **File: `packages/shared-types/src/agent.ts`**
    ```typescript
    import { z } from "zod";

    export const AgentTypeSchema = z.union([
      z.literal("BE Boilerplate"),
      z.literal("FE Boilerplate"),
      z.literal("BE CRUD APIs"),
      z.literal("FE CRUD Services"),
      z.literal("UI CRUD Pages"),
    ]);

    export type AgentType = z.infer<typeof AgentTypeSchema>;

    export const AgentSchema = z.object({
      agentType: AgentTypeSchema,
      currentStep: z.number(),
      totalSteps: z.number(),
      status: z.union([
        z.literal("idle"),
        z.literal("running"),
        z.literal("done"),
        z.literal("failed"),
      ]),
    });

    export type Agent = z.infer<typeof AgentSchema>;
    ```

    **File: `packages/shared-types/src/template.ts`**
    ```typescript
    import { z } from "zod";

    export const TemplateTypeSchema = z.union([
      z.literal("BE boilerplate"),
      z.literal("FE boilerplate"),
      z.literal("BE CRUD"),
      z.literal("FE CRUD"),
      z.literal("UI CRUD"),
    ]);

    export type TemplateType = z.infer<typeof TemplateTypeSchema>;

    export const TemplateSchema = z.object({
      name: z.string(),
      type: TemplateTypeSchema,
      path: z.string(), // .templates/ directory path
      content: z.string(), // Handlebars template
      variables: z.array(z.string()), // Required variable names
    });

    export type Template = z.infer<typeof TemplateSchema>;
    ```

    Key decisions:
    - Log has source to distinguish agent vs system logs
    - AgentType matches specialized CRUD agents from Phase 15
    - TemplateType matches template categories from Phase 14
  </action>
  <verify>
    - Run `tsc --noEmit` in packages/shared-types - should compile without errors
    - Verify all types are importable: test import each from workspace package
    - Check Zod schemas validate correctly: test with valid/invalid objects
  </verify>
  <done>
    Log, Agent, and Template types are defined with Zod schemas and TypeScript types
  </done>
</task>

<task type="auto">
  <name>Configure package.json exports for shared-types</name>
  <files>packages/shared-types/package.json</files>
  <action>
    Update packages/shared-types/package.json with exports field (NOT barrel files):

    ```json
    {
      "name": "@convex-poc/shared-types",
      "version": "0.1.0",
      "type": "module",
      "private": true,
      "exports": {
        "./task": "./src/task.ts",
        "./subtask": "./src/subtask.ts",
        "./log": "./src/log.ts",
        "./agent": "./src/agent.ts",
        "./template": "./src/template.ts"
      },
      "scripts": {
        "build": "tsc",
        "test": "vitest run"
      },
      "dependencies": {
        "zod": "workspace:*"
      },
      "devDependencies": {
        "typescript": "workspace:*",
        "@types/node": "workspace:*"
      }
    }
    ```

    This is the RESEARCH.md Pattern 4 - package.json exports instead of barrel files.

    Usage in other packages:
    ```typescript
    import { Task } from "@convex-poc/shared-types/task";
    import { SubTask } from "@convex-poc/shared-types/subtask";
    ```

    Do NOT create an index.ts barrel file - this breaks tree-shaking per RESEARCH.md.
  </action>
  <verify>
    - Run `pnpm install` in root - should resolve @convex-poc/shared-types dependencies
    - Test import from another package: `import { Task } from '@convex-poc/shared-types/task'`
    - Verify no index.ts barrel file exists in packages/shared-types
  </verify>
  <done>
    package.json exports are configured and types are importable across workspace
  </done>
</task>

</tasks>

<verification>
Overall phase checks:
- `pnpm install` resolves all dependencies
- All types are importable: `import { Task } from '@convex-poc/shared-types/task'`
- TypeScript compiles without errors: `tsc --noEmit`
- Zod schemas validate correctly
- No barrel files (index.ts) exist
- package.json exports field is used
</verification>

<success_criteria>
1. @convex-poc/shared-types package exists with all domain entity types
2. Zod schemas are defined for runtime validation
3. Union types are used for fixed values (not enums)
4. package.json exports field enables type imports
5. No barrel files exist
</success_criteria>

<output>
After completion, create `.planning/phases/13-foundation/13-02-SUMMARY.md`
</output>
