---
phase: 13-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pnpm-workspace.yaml
  - package.json
  - turbo.json
  - tsconfig.json
  - apps/desktop/package.json
  - packages/shared-types/package.json
  - packages/convex-client/package.json
  - packages/agent-orchestrator/package.json
  - packages/template-engine/package.json
autonomous: true

must_haves:
  truths:
    - "Developer can run pnpm install and all workspace dependencies resolve correctly"
    - "Workspace has apps/ and packages/ directories with proper structure"
    - "Turborepo is configured with build and test pipelines"
  artifacts:
    - path: "pnpm-workspace.yaml"
      provides: "Workspace package definitions"
      contains: "packages: - 'apps/*' - 'packages/*'"
    - path: "turbo.json"
      provides: "Turborepo pipeline configuration"
      contains: "pipeline: { build, test }"
    - path: "apps/desktop/package.json"
      provides: "Electron app package placeholder"
      exists: true
    - path: "packages/shared-types/package.json"
      provides: "Shared types package"
      exists: true
  key_links:
    - from: "package.json (root)"
      to: "apps/*, packages/*"
      via: "workspace: protocol"
      pattern: "workspace:\\*"
    - from: "turbo.json"
      to: "package.json scripts"
      via: "task pipeline definition"
      pattern: "dependsOn"
---

<objective>
Establish pnpm workspace foundation with apps/ and packages/ structure and Turborepo orchestration.

Purpose: This is the foundational infrastructure that enables type-safe mono-repo development. All other plans depend on this workspace structure being correctly configured.
Output: Working pnpm workspace with Turborepo, ready for package creation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/13-foundation/13-CONTEXT.md
@.planning/phases/13-foundation/13-RESEARCH.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Initialize pnpm workspace configuration</name>
  <files>pnpm-workspace.yaml, package.json, tsconfig.json</files>
  <action>
    Create pnpm workspace configuration:

    1. Create `pnpm-workspace.yaml`:
    ```yaml
    packages:
      - 'apps/*'
      - 'packages/*'
    ```

    2. Update root `package.json`:
    - Add `"name": "convex-poc-monorepo"` to root package.json
    - Add `"private": true"` to prevent accidental publishing
    - Add Turborepo and pnpm to devDependencies: `pnpm add -D -w turbo typescript @types/node`
    - Update scripts to use Turborepo:
      ```json
      "scripts": {
        "dev": "turbo run dev",
        "build": "turbo run build",
        "test": "turbo run test",
        "lint": "turbo run lint"
      }
      ```
    - Keep existing dependencies in root (they'll be migrated to appropriate packages later)

    3. Update `tsconfig.json` for monorepo:
    - Add `"composite": true` for project references
    - Add paths mapping for workspace packages (optional, for cleaner imports)

    Do NOT use npm workspaces or yarn workspaces - research confirms pnpm is the standard for 2025.
  </action>
  <verify>
    Run `pnpm install` and verify:
    - No errors about workspace configuration
    - `node_modules/.pnpm/` workspace linking structure exists
    - Run `pnpm list` - should show root dependencies
  </verify>
  <done>
    pnpm workspace is configured and `pnpm install` completes successfully
  </done>
</task>

<task type="auto">
  <name>Create apps/ and packages/ directory structure</name>
  <files>apps/desktop/package.json, packages/shared-types/package.json, packages/convex-client/package.json, packages/agent-orchestrator/package.json, packages/template-engine/package.json</files>
  <action>
    Create mono-repo directory structure with placeholder package.json files:

    1. Create directory structure:
    ```
    apps/
      desktop/          # Electron app (future phases)
    packages/
      shared-types/     # TypeScript types + Zod schemas
      convex-client/    # Convex client wrapper
      agent-orchestrator/  # Agent logic (from existing src/)
      template-engine/  # Code generation (future)
    ```

    2. Create package.json for each package with standard structure:
    ```json
    {
      "name": "@convex-poc/[package-name]",
      "version": "0.1.0",
      "type": "module",
      "private": true,
      "exports": {
        "./[entry]": "./src/[entry].ts"
      },
      "scripts": {
        "build": "tsc",
        "test": "vitest run"
      },
      "dependencies": {},
      "devDependencies": {
        "typescript": "workspace:*",
        "@types/node": "workspace:*"
      }
    }
    ```

    3. Create placeholder `src/` directory and empty `index.ts` in each package

    For `packages/agent-orchestrator`: Note that this will contain existing `src/agents/*` code (migration happens in later phases or in this plan's execution - use discretion)

    Use `@convex-poc/*` naming convention (not `@repo/*`) - see CONTEXT.md decision.

    Do NOT create barrel files (index.ts re-exports) - use package.json exports field per RESEARCH.md anti-patterns.
  </action>
  <verify>
    Run `pnpm install` and verify:
    - All workspace packages are linked: `pnpm list --depth 0`
    - No "Cannot find module" errors for workspace packages
    - Directory structure exists: `ls -la apps/ packages/`
  </verify>
  <done>
    Workspace packages created and all dependencies resolve via `workspace:*` protocol
  </done>
</task>

<task type="auto">
  <name>Configure Turborepo pipeline</name>
  <files>turbo.json</files>
  <action>
    Create `turbo.json` with pipeline configuration:

    ```json
    {
      "$schema": "https://turbo.build/schema.json",
      "pipeline": {
        "build": {
          "dependsOn": ["^build"],
          "outputs": ["dist/**", ".next/**"]
        },
        "dev": {
          "cache": false,
          "persistent": true
        },
        "test": {
          "dependsOn": ["build"],
          "outputs": []
        },
        "lint": {
          "outputs": []
        }
      }
    }
    ```

    Key configuration decisions:
    - `build` depends on `^build` (all upstream builds) - ensures packages build in dependency order
    - `dev` has `cache: false` and `persistent: true` - for dev servers that stay running
    - `test` depends on `build` - tests run after builds complete
    - `lint` has no outputs - runs quickly with full caching

    This is the standard Turborepo pattern from RESEARCH.md.

    Create `.gitignore` entry for `.turbo/` cache directory if not present.
  </action>
  <verify>
    Run `turbo run build --dry-run` and verify:
    - Turborepo parses pipeline configuration
    - No errors about invalid JSON or missing packages
    - Run `turbo bin` - shows Turborepo binary path
  </verify>
  <done>
    Turborepo is configured and pipeline commands are ready for execution
  </done>
</task>

</tasks>

<verification>
Overall phase checks:
- `pnpm install` completes without errors
- `pnpm list` shows all workspace packages linked
- `ls -la apps/ packages/` shows correct directory structure
- `turbo run build --dry-run` validates pipeline configuration
- All package.json files use `workspace:*` protocol for internal dependencies
</verification>

<success_criteria>
1. pnpm workspace configuration is valid and install succeeds
2. apps/ and packages/ directories exist with package.json files
3. Turborepo pipeline is configured with build, test, dev, and lint tasks
4. All workspace packages use `@convex-poc/*` naming convention
5. Internal dependencies use `workspace:*` protocol
</success_criteria>

<output>
After completion, create `.planning/phases/13-foundation/13-01-SUMMARY.md`
</output>
